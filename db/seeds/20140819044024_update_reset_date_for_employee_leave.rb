EmployeeLeave.connection.execute("UPDATE employee_leaves el INNER JOIN (select id,MIN(attendance_date) AS min_date, employee_leave_type_id, employee_id FROM employee_attendances GROUP BY employee_id,employee_leave_type_id) ea ON el.employee_leave_type_id=ea.employee_leave_type_id SET el.reset_date = ea.min_date, el.updated_at=NOW() WHERE el.employee_id=ea.employee_id and el.reset_date is NULL;")