<% unless user_palettes.empty? %>
  <div class="column" id="col-1">
    <% user_palettes.select{|p| p.column_number==1}.sort_by{|s| s.position}.each do|u_palette| %>
    <% palette = u_palette.palette %>
      <div class="portlet" id="<%= palette.id %>-palette">
    <%#= render :partial=>"user_palette", :locals=>{:palette=>palette, :cur_date=>cur_date} %>
        <% minimized = u_palette.is_minimized %>
    <%# minimized = UserPalette.find_by_user_id_and_palette_id(@current_user.id,palette.id).is_minimized %>
        <div class="portlet-header">
          <div class="<%= palette.icon %> palette-icon"></div><span class="name-span"><%=  t("data_palettes.#{palette.name}") %></span>
          <% if minimized == true %>
            <span class='ui-icon ui-icon-plusthick'></span>
          <% else %>
            <span class='ui-icon ui-icon-minusthick'></span>
          <% end %>
          <span class="refresh-icon" id='<%= "#{palette.name}-refresh" %>'></span>
        </div>
        <div class="portlet-content" id='<%= "#{palette.name}-palette-content" %>' style="<%= minimized==true ? "display:none;" : "display:block;"   %>" >
    <%#= render :partial=>"palette_content", :locals=>{:palette=>palette, :cur_date=>cur_date} %>
        </div>
      </div>
    <% end %>
  </div>
  <div class="column" id="col-2">
    <% user_palettes.select{|p| p.column_number==2}.sort_by{|s| s.position}.each do|u_palette| %>
    <% palette = u_palette.palette %>
      <div class="portlet" id="<%= palette.id %>-palette">
    <%#= render :partial=>"user_palette", :locals=>{:palette=>palette, :cur_date=>cur_date} %>
        <% minimized = u_palette.is_minimized %>
    <%# minimized = UserPalette.find_by_user_id_and_palette_id(@current_user.id,palette.id).is_minimized %>
        <div class="portlet-header">
          <div class="<%= palette.icon %> palette-icon"></div><span class="name-span"><%=  t("data_palettes.#{palette.name}") %></span>
          <% if minimized == true %>
            <span class='ui-icon ui-icon-plusthick'></span>
          <% else %>
            <span class='ui-icon ui-icon-minusthick'></span>
          <% end %>
          <span class="refresh-icon" id='<%= "#{palette.name}-refresh" %>'></span>
        </div>
        <div class="portlet-content" id='<%= "#{palette.name}-palette-content" %>' style="<%= minimized==true ? "display:none;" : "display:block;"   %>" >
    <%#= render :partial=>"palette_content", :locals=>{:palette=>palette, :cur_date=>cur_date} %>
        </div>
      </div>
    <% end %>
  </div>
  <div class="column" id="col-3">
    <% user_palettes.select{|p| p.column_number==3}.sort_by{|s| s.position}.each do|u_palette| %>
    <% palette = u_palette.palette %>
      <div class="portlet" id="<%= palette.id %>-palette">
    <%#= render :partial=>"user_palette", :locals=>{:palette=>palette, :cur_date=>cur_date} %>
        <% minimized = u_palette.is_minimized %>
    <%# minimized = UserPalette.find_by_user_id_and_palette_id(@current_user.id,palette.id).is_minimized %>
        <div class="portlet-header">
          <div class="<%= palette.icon %> palette-icon"></div><span class="name-span"><%=  t("data_palettes.#{palette.name}") %></span>
          <% if minimized == true %>
            <span class='ui-icon ui-icon-plusthick'></span>
          <% else %>
            <span class='ui-icon ui-icon-minusthick'></span>
          <% end %>
          <span class="refresh-icon" id='<%= "#{palette.name}-refresh" %>'></span>
        </div>
        <div class="portlet-content" id='<%= "#{palette.name}-palette-content" %>' style="<%= minimized==true ? "display:none;" : "display:block;"   %>" >
    <%#= render :partial=>"palette_content", :locals=>{:palette=>palette, :cur_date=>cur_date} %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="empty-palettes"><%= t('no_palettes_selected') %></div>
<% end %>
